\section{Geometry Background: Volume Forms on Submanifolds}\label{ch:vol_forms}
In this appendix we develop the geometric machinery which will be used to derive computationally efficient formulas for the scattering integrals. This facilitates the study  of the neutrino freeze-out using the Boltzmann-Einstein equation in Section \ref{ch:param_studies}.  This appendix is much more mathematical than the main text and, when standard, we use geometrical language and notation here without further explanation;  see, e.g., \cite{lee2003introduction,lee1997riemannian,o1983semi}.  We found this formalism to be useful for our development of an improved method for computing scattering integrals, as presented in Appendix \ref{ch:coll_simp}.  However, if one is content with simply using the results then this appendix is non-essential. See also   \cite{Birrell:2014uka}.



\subsection{Inducing Volume Forms on Submanifolds}

Given a Riemannian manifold $(M,g)$ with volume form $dV_g$ and a  hypersurface $S$, the standard Riemannian hypersurface area form, $dA_g$, is defined on $S$ as the volume form of the pullback metric tensor on $S$.   Given vectors $v_1,...,v_k$ we define the interior product (i.e. contraction)  operator acting on a form $\omega$ of degree $n\geq k$ as the $n-k$ form 
\begin{equation}
i_{(v_1,...,v_k)}\omega=\omega(v_1,...,v_k,\cdot)\,.
\end{equation}
 With this notation, the hypersurface area form can equivalently be computed as
\begin{equation}
dA_g=i_v dV_g\,,
\end{equation}
where $v$ is a unit normal vector to $S$.  This method extends to submanifolds of codimension greater than one as well as to semi-Riemannian manifolds, as long as the metric restricted to the submanifold is non-degenerate. 

However, there are many situations where one would like to define a natural volume form on a submanifold that is induced by a volume form in the ambient space, but where the above method is inapplicable, such as defining a natural volume form on the light cone or other more complicated degenerate submanifolds in general relativity. In this section, we will describe a method for inducing volume forms on regular level sets of a function that is applicable in cases where there is no metric structure and show its relation to more widely used semi-Riemannian case.  We prove analogues of the coarea formula and Fubini's theorem in this setting. 

Let $M$, $N$ be smooth manifolds, $c$ be a regular value of a smooth function $F:M\rightarrow N$, and $\Omega^M$ and $\Omega^N$ be volume forms on $M$ and $N$ respectively.  Using this data, we will be able to induce a natural volume form on the level set $F^{-1}(c)$.  The absence of a metric on $M$ is made up for by the additional information that the function $F$ and volume form $\Omega^N$ on $N$ provide. The following theorem makes our definition precises and proves the existence and uniqueness of the induced volume form.

\begin{theorem}\label{induced_vol_form}
Let $M$, $N$ be $m$ (resp. $n$)-dimensional smooth manifolds with volume forms $\Omega^M$ (resp. $\Omega^N$). Let $F:M\rightarrow N$ be smooth and $c$ be a regular value.  Then there is a unique volume form $\omega$  (also denoted $\omega^M$) on $F^{-1}(c)$ such that $\omega_x=i_{(v_1,...,v_n)}\Omega^M_x$ whenever $v_i\in T_xM$ are such that 
\begin{equation}\label{unit_volume}
\Omega^N(F_*v_1,...,F_* v_n)=1\,.
\end{equation}
We call $\omega$ the {\bf volume form induced by $F:(M,\Omega^M)\rightarrow (N,\Omega^N)$}.
\end{theorem}
\begin{proof}
$F_*$ is onto $T_{F(x)}N$ for any $x\in F^{-1}(c)$.  Hence there exists $\{v_i\}_1^n\subset T_xM$ such that $\Omega^N(F_*v_1,...,F_* v_n)=1$.  In particular, $F_* v_i$ is a basis for $T_{F(x)} N$.  Define $\omega_x=i_{(v_1,...,v_n)}\Omega_x$. This is obviously a nonzero $m-n$ form on $T_xF^{-1}(c)$ for each $x\in F^{-1}(c)$.  We must show that this definition is independent of the choice of $v_i$ and the result is smooth.

 Suppose $F_*v_i$ and $F_*w_i$ both satisfy \req{unit_volume}.  Then $F_*v_i=A_i^jF_*w_j$ for $A\in SL(n)$. Therefore $v_i-A_i^jw_j\in \ker F_{*x}$.  This implies
\begin{equation}
i_{(v_1,...,v_n)}\Omega^M_x=\Omega^M_x(A_1^{j_1}w_{j_1},...,A_n^{j_n}w_{j_n},\cdot)
\end{equation}
since the terms involving $\ker F_*$ will vanish on $T_x F^{-1}(c)=\ker F_{*x}$.  Therefore
\begin{align}\label{ind_of_v_proof}
i_{(v_1,...,v_n)}\Omega^M_x&=A_1^{j_1}...A_n^{j_n}\Omega^M_x(w_{j_1},...,w_{j_n},\cdot)\\
&=\sum_{\sigma\in S_n} \pi(\sigma)A_1^{\sigma(1)}...A_n^{\sigma(n)}\Omega^M_x(w_1,...,w_n,\cdot)\notag\\
&=\det(A)i_{(w_1,...,w_n)}\Omega^M_x\notag\\
&=i_{(w_1,...,w_n)}\Omega^M_x\,.\notag
\end{align}
This proves that $\omega$ is independent of the choice of $v_i$.  If we can show $\omega$ is smooth then we are done.  We will do better than this by proving that for any  $v_i\in T_xM$ the following holds
\begin{equation}
i_{(v_1,...,v_n)}\Omega^M_x=\Omega^N(F_*v_1,...,F_*v_n)\omega_x\,.
\end{equation}
To see this, take $w_i$ satisfying \req{unit_volume}.  Then $F_*v_i=A_i^j F_*w_j$. This determinant can be computed from
\begin{align}
\Omega^N(F_*v_1,...,F_*v_n)=\det(A)\Omega^N(F_*w_1,...,F_*w_n)=\det(A)\,.
\end{align}
 Therefore, the same computation as \req{ind_of_v_proof} gives
\begin{align}
i_{(v_1,...,v_n)}\Omega^M_x=\det(A)\omega_x=\Omega^N(F_*v_1,...,F_*v_n)\omega_x
\end{align}
as desired.  To prove that $\omega$ is smooth, take a smooth basis of vector fields $\{V_i\}_1^m$ in a neighborhood of $x$.  After relabeling, we can assume $\{F_*V_i\}_1^n$ are linearly independent at $F(x)$ and hence, by continuity, they are linearly independent at $F(y)$ for all $y$ in some neighborhood of $x$.  In that neighborhood, $\Omega^N(F_*V_1,...,F_*V_n)$ is non-vanishing and therefore
\begin{equation}
\omega=(\Omega^N(F_*V_1,...,F_*V_n))^{-1}i_{(V_1,...,V_n)}\Omega
\end{equation} 
which is smooth.
\end{proof}

\begin{corollary}\label{induced_vol_eq}
For any  $v_i\in T_xM$ the following holds
\begin{equation}\label{vol_formula1}
i_{(v_1,...,v_n)}\Omega^M_x=\Omega^N(F_*v_1,...,F_*v_n)\omega_x\,.
\end{equation}
\end{corollary}



\begin{corollary}
If $\phi:M\rightarrow\mathbb{R}$ is smooth and $c$ is a regular value then by equipping $\mathbb{R}$ with its canonical volume form we have 
\begin{equation}
\omega_x=i_v\Omega^M_x\,,
\end{equation}
where $v\in T_xM$ is any vector satisfying $d\phi(v)=1$.
\end{corollary}

It is useful to translate  \req{vol_formula1} into a form that is more readily applicable to computations in coordinates.  Choose arbitrary coordinates $y^i$ on $N$ and write $\Omega^N=h^N(y) dy^n$. Choose coordinates $x^i$ on $M$ such that $F^{-1}(c)$ is the coordinate slice
\begin{equation}
F^{-1}(c)=\{x:x^1=...=x^n=0\}
\end{equation}
and write $\Omega^M=h^M(x)dx^m$. The coordinate vector fields $\partial_{x^i}$ are transverse to $F^{-1}(c)$ and so
\begin{equation}
\Omega^N(F_*\partial_{x^1},...,F_*\partial_{x^n})=h^N(F(x))\det \left(\frac{\partial F^i}{\partial x^j}\right)_{i,j=1..n}
\end{equation}
and
\begin{equation}
i_{(\partial_{x^1},...,\partial_{x^n})}\Omega^M=h^M(x) dx^{n+1}...dx^m\,.
\end{equation}
Therefore we obtain
\begin{equation}\label{vol_form_coords}
\omega_x=\frac{h^M(x)}{h^N(F(x))}\det \left(\frac{\partial F^i}{\partial x^j}\right)^{-1}_{i,j=1..n}dx^{n+1}...dx^m\,.
\end{equation}

Just like in the (semi)-Riemannian case, the induced measure allows us to prove a coarea formula where we break integrals over $M$ into slices. In this theorem and the remainder of the section, we consider integration with respect to the density defined by any given volume form, i.e., we ignore the question of defining consistent orientations.
\begin{theorem}[Coarea formula]\label{vol_form_coarea}
Let $M$ be a smooth manifold with volume form $\Omega^M$, $N$ a smooth manifold with volume form $\Omega^N$ and $F:M\rightarrow N$ be a smooth map.  If $F_*$ is surjective at a.e. $x\in M$ then for $f\in L^1(\Omega^M)\bigcup L^+(M)$ we have
\begin{equation}\label{coarea_formula}
\int_Mf(x) \Omega^M(dx)=\int_{N}\int_{F^{-1}(z)} f(y)\omega^M_z(dy) \Omega^N(dz)\,,
\end{equation}
where $\omega^M_z$ is the volume form induced on $F^{-1}(z)$ as in Lemma \ref{induced_vol_form}.
\end{theorem}
\begin{proof}
First suppose $F$ is a submersion. By the rank theorem there exists a countable collection of charts $(U_i,\Phi_i)$ that cover $M$ and corresponding charts $(V_i,\Psi_i)$ on $N$ such that 
\begin{align}
\Psi_i\circ F\circ \Phi_i^{-1}(y^1,...,y^{m-n},z^1,...,z^n)=(z^1,...,z^n)\,.
\end{align}
Let $\sigma_i$ be a partition of unity subordinate to $U_i$.  For each $i$ and $z$ we have $\Phi_i(U_i\cap F^{-1}(z))=\left(\mathbb{R}^{m-n}\times\{\Psi_i(z)\}\right)\cap \Phi_i(U_i)$.  We can assume that the $\Phi_i(U_i)=U_i^1\times U_i^2\subset \mathbb{R}^{m-n}\times \mathbb{R}^n$ and therefore each $\Phi_i$ is a slice chart for $F^{-1}(z)$ for all $y$ such that $F^{-1}(z)\cap U_i\neq \emptyset$.  In other words, $\Phi_i(U_i\cap F^{-1}(z))= U_i^1\times \{\Psi(z)\}$.  This lets us compute the left and right hand sides of \req{coarea_formula} for $f\in L^+(M)$:
\begin{align}
\int_Mf(x) \Omega^M(dx)&=\sum_i\int_{U_i}(\sigma_if)(x) \Omega^M(dx)\\
&=\sum_i\int_{\Phi_i(U_i)}(\sigma_if)\circ \Phi^{-1}(y,z) \Phi^{-1*}\Omega^M(dy,dz)\notag\\
&=\sum_i\int_{\Phi_i(U_i)}(\sigma_if)\circ \Phi^{-1}(y,z)|g^M(y,z)| dy^{m-n}dz^n\notag\\
&=\sum_i\int_{U_i^2}\left[\int_{U_i^1}(\sigma_if)\circ \Phi^{-1}(y,z)|g^M(y,z)| dy^{m-n}\right]dz^n\notag\\
&\text{where }\Omega^M=g^M dy^1\wedge...\wedge dy^{m-n}\wedge dz^1\wedge...\wedge dz^n\,,\notag
\end{align}
and
\begin{align}
&\int_{N}\int_{F^{-1}(z)} f(y)\omega^M_z(dy) \Omega^N(dz)\\
=&\sum_i \int_{N}\left[\int_{\Phi_i(U_i\cap F^{-1}(z))} (\sigma_if)\circ\Phi_i^{-1}(y,\Psi(z))\Phi_i^{-1*}\omega^M_z(dy)\right] \Omega^N(dz)\notag\\
=&\sum_i \int_{V_i}\left[\int_{\Phi_i(U_i\cap F^{-1}(z))} (\sigma_if)\circ\Phi_i^{-1}(y,\Psi(z))\Phi_i^{-1*}\omega^M_z(dy)\right] \Omega^N(dz)\notag\\
=&\sum_i \int_{\Psi_i(V_i)}\left[\int_{\Phi_i(U_i\cap F^{-1}(\Psi^{-1}(z))} (\sigma_if)\circ\Phi_i^{-1}(y,z)\Phi_i^{-1*}\omega^M_z(dy)\right] \Psi^{-1*}\Omega^N(dz)\notag\\
=&\sum_i \int_{U_i^2}\left[\int_{U_i^1\times \{z\}} (\sigma_if)\circ\Phi_i^{-1}(y,z)|g^M_z(y)| dy^{m-n}\right] |g^N(z)| dz^n\,,\notag\\
&\text{where }\omega^M_z=g^M_z dy^1\wedge...\wedge dy^{m-n} \text{ and }\Omega^N=g^N dz^1\wedge...\wedge dz^n \text{ for } g_1^M,g_N>0\,.\notag
\end{align}
\begin{comment}
Here we used that if \pi_1\circ \Phi is the chart on F^{-1}(z) then the inverse is y->\Phi^{-1}(y,Psi(z)) since \pi_2\circ\Phi(x)=\Psi(z)
for any x\in F^{-1}(z)
\end{comment}
Therefore, if we can show $|g^M(y,z)|=|g_z^M(y)g^N(z)|$ on $U_i^1\times U_i^2$ we are done. From Corollary \ref{induced_vol_eq} we have
\begin{align}
&(-1)^{n(m-n)} g^M(y,z)\\
=&\Omega^M(\partial_{z^1},...,\partial_{z^n},\partial_{y^1},...,\partial_{y^{m-n}})=\Omega^N(F_*\partial_{z^n},...,F_*\partial_{z^n})g_z^M(y)\,.\notag
\end{align}
Since $\Psi\circ F\circ\Phi^{-1}=\pi_2$ we have $F_*\partial_{z^j}=\partial_{z_j}$ and so $\Omega^N(F_*\partial_{z^n},...,F_*\partial_{z^n})=g^N$ which completes the proof in the case where $F$ is a submersion.  The generalization to the case where $F_*$ is surjective a.e. follows from Sard's theorem and the fact that the set of $x\in M$ at which $F_*$ is surjective is open.

\begin{comment}
The set K of $x\in M$ where $F_*$ is surjective is open in M by the rank theorem and by assumption, its complement has M-measure zero.  Therefore the lhs equal int_K f dOmega^M. F is a submersion on $K$ so   int_K f dOmega^M=int_N int_F|K^{-1}(z) f omega^M_z Omega^N.  Split this into an integral over regular values of $F:M->N$ and crit values.  The int over crit values is zero by Sard.  For z a regular value, F|_K^{-1}(z)=F^{-1}(z) Hence the lhs is int_N_ref int_F^{-1}(z) f omega^M_z Omega^N. 

  Split the rhs into integral over critical  values of F:M->N and regular values.  The integral over crit values is
 zero by sard, hence the rhs is
int_N_reg int F^{-1}(z).  Therefore they are equal.  QED
\end{comment}
\end{proof}
\subsection{Comparison to Riemannian Coarea Formula}
We now recall the classical coarea formula for semi-Riemannian metrics, see, e.g., \cite{chavel1995riemannian},  and give its relation to theorem \ref{vol_form_coarea}.
\begin{definition}
Let $F:(M,g)\rightarrow (N,h)$ be a smooth map between semi-Riemannian manifolds.  The {\bf normal Jacobian} of $F$ is
\begin{equation}
NJF(x)=|\det(F_*|_x(F_*|_x)^T)|^{1/2}\,,
\end{equation}
where $(F_*|_x)^T$ denotes the adjoint map $T_xN\rightarrow T_xM$ obtained pointwise from the pullback $T^*N\rightarrow T^*M$ combined with the tangent-cotangent bundle isomorphisms defined by the metrics.
\end{definition}

\begin{lemma}
The normal Jacobian has the following properties.
\begin{itemize}
\item $(F_*|_x)^T:T_{F(x)}N\rightarrow (\ker F_*|_x)^\perp$.
\item If $F_*|_x$ is surjective then $(F_*|_x)^T$ is 1-1.
\item In coordinates
\begin{equation}
NJF(x)=\left|\det\left(h_{ik}(F(x))\frac{\partial F^k}{\partial x^l}(x)g^{lm}(x)\frac{\partial F^j}{\partial x^m}(x)\right)\right|^{1/2}\,.
\end{equation}
\item  If $F_*|_x$ is surjective and $g$ is nondegenerate on $ker F_*|_x$ then $F_*|_x(F_*|_x)^T$ is invertible.
\item If $c\in N$ is a regular value of $F$ and $g$ is nondegenerate on $F^{-1}(c)$ then $NJF(x)$ is non-vanishing and smooth on $F^{-1}(c)$.
\end{itemize}
\end{lemma}

Combining these lemmas with the rank theorem, one can prove the standard semi-Riemannian coarea formula
\begin{theorem}[Coarea formula]
Let $F:(M,g)\rightarrow (N,h)$ be a smooth map between semi-Riemannian manifolds such that $F_*$ is surjective at a.e. $x\in M$ and $g$ is nondegenerate on $F^{-1}(c)$ for a.e $c\in N$.  Then for $\phi\in L^1(dV_g)$ we have
\begin{equation}
\int_M\phi(x)dV_g=\int_{y\in N}\int_{x\in F^{-1}(y)}\frac{\phi(x)}{NJF(x)}dA_g dV_h\,,
\end{equation}
where $dA_g$ is the volume measure induced on $F^{-1}(y)$ by pulling back the metric $g$.  In particular, if $N=\mathbb{R}$ with its canonical metric then $NJF=|\nabla F|$ and 
\begin{equation}
\int_M \phi dV_g=\int_\mathbb{R}\int_{F^{-1}(r)}\frac{\phi(x)}{|\nabla F(x)|} dA_g dr\,.
\end{equation}
\end{theorem}

The relation between the Riemannian coarea theorem and Theorem \ref{vol_form_coarea} follows from the following theorem.
\begin{theorem}
Let $F:(M,g)\rightarrow (N,h)$  be a smooth map between semi-Riemannian manifolds and $c$ be a regular value.  Suppose $g$ is nondegenerate on $F^{-1}(c)$.  Let $\omega$ be the volume form on $F^{-1}(c)$ induced by $F:(M,dV_g)\rightarrow (N,dV_h)$.  Then
\begin{equation}
\omega=NJF^{-1}dA_g
\end{equation}
as densities.
\end{theorem}
\begin{proof}
By Corollary \ref{induced_vol_eq}, for any  $v_i\in T_xM$ we have
\begin{equation}
i_{(v_1,...,v_n)}\Omega^M_x=dV_h(F_*v_1,...,F_*v_n)\omega_x\,.
\end{equation}
If we let $v_i$ be an orthonormal basis of vectors orthogonal to $F^{-1}(c)$ at $x$ then $F_*v_i$ are linearly independent and so
\begin{align}
\omega=&(dV_h(F_*v_1,...,F_*v_n))^{-1}i_{(v_1,...,v_n)}dV_g\\
=&(dV_h(F_*v_1,...,F_*v_n))^{-1}dA_g\,.\notag
\end{align}
Choose coordinates about $x$ and $F(x)$ so that $\partial_{x^i}=v_i$ for $i=1...n$, $\{\partial_{x^i}\}_{n+1}^m$ span $\ker F_*$, and $\partial_{y_i}$ are orthonormal.  Then 
\begin{align}
dV_h(F_*v_1,...,F_*v_n)&=\sqrt{|\det(h)|}\frac{\partial F^{j_1}}{\partial x^1}...\frac{\partial F^{j_n}}{\partial x^n}dy^1\wedge...\wedge dy^n(\partial_{y^{j_1}},...,\partial_{y^{j_n}})\\
&=\det\left(\frac{\partial F^{j}}{\partial x^i}\right)_{i,j=1}^n\,.\notag
\end{align}
$F_*\partial_{x^i}=0$ for $i=n+1...m$ and so $\frac{\partial F^j}{\partial x_i}=0$ for $i=n+1...m$.  Letting $\eta=\diag(\pm 1)$ be the signature of $g$, we find
\begin{align}
NJF(x)=&\left|\det\left(h_{ik}(F(x))\frac{\partial F^k}{\partial x^l}(x)g^{lm}(x)\frac{\partial F^j}{\partial x^m}(x)\right)\right|^{1/2}\\
=&\left|\det\left(\sum_{l,m=1}^n\frac{\partial F^k}{\partial x^l}(x)\eta^{lm}(x)\frac{\partial F^j}{\partial x^m}(x)\right)\right|^{1/2}\notag\\
=&\left|\det\left(\frac{\partial F^k}{\partial x^l}\right)_{k,l=1}^n\det(\eta^{lm})_{l,m=1}^n\det\left(\frac{\partial F^j}{\partial x^m}\right)_{j,m=1}^n\right|^{1/2}\notag\\
=&\left|\det\left(\frac{\partial F^k}{\partial x^l}\right)_{k,l=1}^n\right|\notag\\
=&|dV_h(F_*v_1,...,F_*v_n)|\,.\notag
\end{align}
Therefore 
\begin{equation}
\omega=NJF^{-1}dA_g
\end{equation}
as densities.
\end{proof}
In particular, this shows that even though $NJF$ and $dA_g$ are undefined individually when $g$ is degenerate on $F^{-1}(c)$, one can make sense of their ratio in this situation as the induced volume form $\omega$.


\subsection{Delta Function Supported on a Level Set}
 The induced measure defined above allows for a coordinate independent definition of a delta function supported on a regular level set.  Such an object is of great use in performing calculations in relativistic phase space.  We give the definition and prove several properties that justify several common formal manipulations that one would like to make with such an object.
\begin{definition}
Motivated by the coarea formula, we define the composition of the {\bf Dirac delta function} supported on $c\in N$ with a smooth map $F:M\rightarrow N$ such that $c$ is a regular value of $F$ by
\begin{equation}\label{delta_def}
 \delta_c(F(x))\Omega^M \equiv \omega^M
\end{equation}
on $F^{-1}(c)$.  This is just convenient shorthand, but it commonly used in the physics literature (typically without the justification presented above or in the following results).   For $f\in L^1(\omega^M)$ we will write 
\begin{equation}
\int_M f(x)\delta_c(F(x))\Omega^M(dx)
\end{equation} 
in place of 
\begin{equation}
\int_{F^{-1}(c)} f(x) \omega^M(dx)\,.
\end{equation}



More generally, if the subset of $F^{-1}(c)$ consisting of critical points, a closed set whose complement we call $U$, has $\dim M-\dim N$ dimensional Hausdorff measure zero in $M$ then we define
\begin{equation}
\int_M f(x)\delta_c(F(x))\Omega^M(dx)=\int_{F|_U^{-1}(c)} f(x)\omega^M\,.
\end{equation}
This holds, for example, if $U^c$ is contained in a submanifold of dimension less than  $\dim M-\dim N$.  

Equivalently, we can replace $U$ in this definition with any {\bf open} subset of $U$ whose complement still has $\dim M-\dim N$ dimensional Hausdorff measure zero. In this situation, we will say $c$ is a regular value except for a lower dimensional exceptional set.  Note that while Hausdorff measure depends on a choice of Riemannian metric on $M$, the measure zero subsets are the same for each choice.
\begin{comment}
Hausdorff measures commutes with restriction to subspaces (w/subspace metric)
Hausdorff measure on a submanifold induced by pullback metric tensor equals that induced by restriction of distance metric from ambient space.
Hausdorff measure of subsets of a manifold being zero is well defined (i.e. ind of choice of metric) so we can define k-dimensional measure zero for any k (integer or not). This follows since vol forms are abs cont wrt hausdorff measure of that dim
\end{comment}
\end{definition}

Using \req{vol_form_coords}, along with the coordinates described there, we can (at least locally) write the integral with respect to the delta function in the more readily usable form
\begin{equation}\label{delta_integral_coords}
\int_M f(x)\delta_c(F(x))\Omega^M=\int_{F^{-1}(c)} f(x)\frac{h^M(x)}{h^N(F(x))}\bigg|\det \left(\frac{\partial F^i}{\partial x^j}\right)^{-1}\bigg|dx^{n+1}...dx^m\,.
\end{equation}
The absolute value comes from the fact that we use $\delta_c(F(x))\Omega^M$ to define the orientation on $F^{-1}(c)$.


As expected, such an operation behaves well under diffeomorphisms.
\begin{lemma}\label{diffeo_property}
Let $c$ be a regular value of $F:M\rightarrow N$ and $\Phi:M^{'}\rightarrow M$ be a diffeomorphism.  Then the delta functions induced by $F:(M,\Omega^M)\rightarrow (N,\Omega^N)$ and $F\circ\Phi:(M^{'},\Phi^*\Omega^M)\rightarrow  (N,\Omega^N)$ satisfy
\begin{equation}
\delta_c(F\circ\Phi)(\Phi^*\Omega^M)=\Phi^*(\delta_c(F)\Omega^M)\,.
\end{equation}
\end{lemma}

\begin{lemma}
Let $c$ be a regular value of $F:(M,\Omega^M)\rightarrow (N,\Omega^N)$ and $\Phi:N\rightarrow (N^{'},\Omega^{N^{'}})$ be a diffeomorphism where $\Phi^*\Omega^{N^{'}}=\Omega^N$.  Then the delta functions induced by $F:(M,\Omega^M)\rightarrow (N,\Omega^N)$ and $\Phi\circ F:(M,\Omega^M)\rightarrow (N^{'},\Omega^{N^{'}})$ satisfy
\begin{equation}
\delta_c(F)\Omega^M=\delta_{\Phi(c)}(\Phi\circ F)\Omega^M\,.
\end{equation}
\end{lemma}

We also have a version of Fubini's theorem.

\begin{theorem}[Fubini's Theorem for Delta functions]
Let $M_1,M_2,N$ be smooth manifolds with volume forms $\Omega_1,\Omega_2, \Omega^N$. Let $M\equiv M_1\times M_2$ and $\Omega\equiv \Omega_1\wedge\Omega_2$. Suppose that the set of $(x,y)\in F^{-1}(c)$ such that $F|_{M_1\times\{y\}}$ is not regular at $x$ has $\dim M_1+\dim M_2-\dim N$ dimensional Hausdorff measure zero in $M_1\times M_2$ (we denote the complement of this closed set by $U$).  Then for $f\in L^1(\omega)\bigcup L^+(F^{-1}(c))$ we have
\begin{equation}\label{Fubini_eq}
\int_Mf(x,y)\delta_c(F(x,y)) \Omega(dx,dy)=\int_{M_2}\left[\int_{U^y} f(x,y) \delta_c(F(x,y))\Omega_1(dx) \right]\Omega_2(dy)\,,
\end{equation}
where $U^y=\{x\in M_1:(x,y)\in U\}$.
\end{theorem}
\begin{proof}
Our assumption about $F|_{M_1\times\{y\}}$ implies that $c$ is a regular value of $F:M_1\times M_2\rightarrow N$ except for the lower dimensional exceptional set $U^c$
\begin{comment}
U is a subset of the set given in the condition.  Both are closed
\end{comment}
and for $y\in M_2$, $c$ is also a regular value of $F|_{U^y\times\{y\}}$, hence both sides of \req{Fubini_eq} are well defined.  Rewriting \req{Fubini_eq} without the delta function, we then need to show that 
\begin{equation}
\int_{F|_U^{-1}(c)} f(x,y) d\omega=\int_{M_2}\left[\int_{F|_{U^y\times\{y\}}^{-1}(c)} f(x,y) \omega^1_{c,y}(dx)\right]\Omega_2(dy)\,,
\end{equation}
where $\omega^1_{c,y}$ is the induced volume form on $F|_{U^y\times\{y\}}^{-1}(c)$.  

Consider the projection map restricted to the $c$-level set, $\pi_2:F|_U^{-1}(c)\rightarrow M_2$.  By assumption, $F|_{M_1\times\{y\}}$ is regular at $x$ for all $(x,y)\in F|_U^{-1}(c)$. For such an $(x,y)$, take a basis $w_i\in T_yM_2$. Since $F|_{M_1\times\{y\}}$ has full rank at $x$, for each $i$ there exists $v_i\in T_xM_1$ such that $F(\cdot,y)_*v_i=F_*(0,w_i)$.  Therefore $(-v_i,w_i)\in \ker F_*|_{(x,y)}=T_{(x,y)}F|_U^{-1}(c)$.  Hence $w_i\in\pi_{2*} T_{(x,y)}F^{-1}(c)$ and so $\pi_2:F|_U^{-1}(c)\rightarrow M_2$ is regular at $(x,y)$.  

Since $\pi_2$ is regular for all $(x,y)\in F|_U^{-1}(c)$ the coarea formula applies, giving
\begin{align}
\int_{F|_U^{-1}(c)}f d\omega=&\int_{M_2}\left[\int_{\pi_2^{-1}(y)}f\tilde{\omega}_{c,y}^1\right]\Omega_2(dy)
\end{align}
for all $f\in L^1(\omega)\bigcup L^+(F^{-1}(c))$, where $\tilde{\omega}_{c,y}^1$ is the volume form on $\pi_2^{-1}(y)$ induced by $\pi_2:(F|_U^{-1}(c),\omega)\rightarrow (M_2,\Omega_2)$.

As a point set, $\pi_2^{-1}(y)=F|_{ U^y\times\{y\}}^{-1}(c)$ and both are embedded submanifolds of $M_1\times M_2$ for a.e. $y\in M_2$, hence are equal as manifolds.  So if we can show $\tilde{\omega}_{c,y}^1=\omega^1_{c,y}$ as densities whenever $F|_{M_1\times\{y\}}$ is regular at $x$ for some $(x,y)$ then we are done.  

Given any such $(x,y)$, take $v_i\in T_xM_1$ such that $\Omega^N(F(\cdot,y)_*v_i)=1$.  By definition, $\omega_{c,y}^1=i_{(v_1,...,v_n)}\Omega_1$.  We also have $(v_i,0)\in T_{(x,y)}M_1\times M_2$ and $\Omega^N(F_*(v_i,0))=1$.  Hence 
\begin{align}
\omega=&i_{((v_1,0),...,(v_n,0))}(\Omega_1\wedge\Omega_2)
=(i_{((v_1,0),...,(v_n,0))}\Omega_1)\wedge\Omega_2\,.
\end{align}
Let $w_i\in T_y M_2$ such that $\Omega_2(w_1,...,w_{m_2})=1$.  By the same argument as above, there exists $\tilde{v}_i\in T_xM_1$ such that $(\tilde{v}_i,w_i)\in \ker F_*=T_{(x,y)}F^{-1}(c)$.  $\pi_{2*}(\tilde{v}_i,w_i)=w_i$ and $\Omega_2(w_1,...,w_{m_2})=1$ so by definition,
\begin{equation}
\tilde{\omega}_{c,y}^1=i_{((\tilde{v}_1,w_1),...,(\tilde{v}_{m_2},w_{m_2}))}\omega\,.
\end{equation}
Since any term containing $\Omega_2$ will vanishes on $T_F(\cdot,y)^{-1}(c)\subset T M_1$, we have  
\begin{align}
\tilde{\omega}_{c,y}^1=&(-1)^{m_1-n}i_{((v_1,0),...,(v_n,0))}\Omega_1\\
=&(-1)^{m_1-n}\omega_{c,y}^1\wedge\left(i_{((\tilde{v}_1,w_1),...,(\tilde{v}_{m_2},w_{m_2}))}\Omega_2\right)\notag\\
=&(-1)^{m_1-n}\omega_{c,y}^1\,.\notag
\end{align}
As we are integrating with respect to the densities defined by $\omega_{c,y}^1$ and $\tilde{\omega}_{c,y}^1$ we are done.  
\end{proof}

Before moving on, we give a few more useful identities.

\begin{theorem}\label{delta_associative}
Let $(c_1,c_2)$ be a regular value of $F\equiv F_1\times F_2:(M,\Omega^M)\rightarrow (N_1\times N_2,\Omega^{N_1}\wedge\Omega^{N_2})$.  Then $c_2$ is a regular value of $F_2$, $c_1$ is a regular value of $F_1|_{F_2^{-1}(c_2)}$ and we have
\begin{equation}
\delta(F)\Omega^M=\delta(F_1)(\delta(F_2)\Omega^M)\,.
\end{equation}
\end{theorem}
\begin{proof}
$(c_1,c_2)$ is a regular value of $F$, hence there exists $v_i$, $w_i$ such that $F_* v_i=(\tilde{v}_i,0)$, $F_* w_i=(0,\tilde{w}_i)$ satisfy 
\begin{equation}
\Omega^{N_1}\wedge\Omega^{N_2}( (\tilde{v}_1,0),..., (0,\tilde{w}_1),...)=1\,.
\end{equation}
After rescaling, we can assume
\begin{equation}
\Omega^{N_1}( \tilde{v}_1,...,\tilde{v}_{n_1})=1,\hspace{2mm} \Omega^{N_2}(\tilde{w}_1,...,\tilde{w}_{n_2})=1\,.
\end{equation}
Therefore $c_2$ is a regular value of $F_2$ and 
\begin{equation}
\delta(F_2)\Omega^M=i_{w_1,...,w_n}\Omega^M\,.
\end{equation}
The tangent space to $F_2^{-1}(c_2)$ is $\ker (F_2)_*$ which contains $v_i$.  Hence $c_1$ is a regular value of $F_1|_{F_2^{-1}(c_2)}$ and 
\begin{align}
\delta(F_1)(\delta(F_2)\Omega^M)=&i_{v_1,...,v_n}\delta(F_2)\Omega^M=\pm i_{v_1,...,v_n,w_1,...,w_n}\Omega^M\,,
\end{align}
therefore they agree as densities.
\end{proof}

\begin{theorem}
Let $c_i\in N_i$ be regular values of $F_i:M_i\rightarrow N_i$ and define $F=F_1\times F_2:M_1\times M_2\rightarrow N_1\times N_2$, $c=(c_1,c_2)$.  If $\Omega^{M_i}$ and $\Omega^{N_i}$ are volume forms on $M_i$ and $N_i$ respectively then 
\begin{equation}
\delta_c( F) \left(\Omega^{M_1}\wedge\Omega^{M_2}\right)=\left(\delta_{c_1}( F_1)\Omega^{M_1}\right)\wedge\left(\delta_{c_2}( F_2)\Omega^{M_2}\right)
\end{equation}
as densities.
\end{theorem}
\begin{proof}
Our assumptions ensure that both sides are $m_1+m_2-n_1-n_2$-forms on $F_1^{-1}(c_1)\times F_2^{-1}(c_2)$.  Choose $v_i^j\in TM_i$ that satisfy $\Omega^{N_i}(F_{i*}v^1_i,...,F_{i*}v^{n_i}_i)=1$ then
\begin{align}
&\Omega^{N_1}\wedge \Omega^{N_2}(F_*(v_1^1,0),...,F_*(v_1^{n_1},0),F_*(0,v_2^1),...,F_*(0,v_2^{n_2}))\\
=&\Omega^{N_1}\wedge \Omega^{N_2}(F_{1*}v_1^1,...,F_{2*}v_2^{n_2})\notag\\
=&\Omega^{N_1}(v_1^1,...,v_1^{n_1})\Omega^{N_2}(v_2^1,...,v_2^{n_2})=1\,.\notag
\end{align}
Therefore, by definition
\begin{align}
\delta_c\circ F \left(\Omega^{M_1}\wedge\Omega^{M_2}\right)=&i_{(v_1^1,0),...,(v_1^{n_1},0),(0,v_2^1),...,(0,v_2^{n_2})}\left(\Omega^{M_1}\wedge\Omega^{M_2}\right)\\
=&(-1)^{n_2}\left(i_{v_1^1,...,v_1^{n_1}}\Omega^{M_1}\right)\wedge\left(i_{v_2^1,...,v_2^{n_2}}\Omega^{M_2}\right)\notag\\
=&(-1)^{n_2}\left(\delta_{c_1}\circ F_1\right)\wedge\left(\delta_{c_2}\circ F_2\right)\,.\notag
\end{align}
Therefore they agree as densities.
\end{proof}

\begin{theorem}\label{delta_product}
Let $F_i:M_i\rightarrow N_i$ and $g:N_1\times N_2\rightarrow K$ be smooth.  Let $\Omega^{M_i}$, $\Omega^{N_1}$, $\Omega^K$ be volume forms on $M_i$, $N_1$, $K$ respectively.  Suppose $c$ is a regular value of $F_1$ and $d$ is a regular value of $g(c,F_2)$ and of $g\circ F_1\times F_2$. Then 
\begin{equation}
\delta_c(F_1)\left[\delta_d( g\circ F_1\times F_2)\left(\Omega^{M_1}\wedge\Omega^{M_2}\right)\right]=\left(\delta_c(F_1)\Omega^{M_1}\right)\wedge\left(\delta_d(g(c, F_2))\Omega^{M_2}\right)\,.
\end{equation}
\end{theorem}
\begin{proof}
 Let $(x,y)\in (f\circ F_1\times F_2)^{-1}(d)$ with $x\in F^{-1}(c)$. For any $w\in T_c N_1$ there exists $v\in T_x M_1$ such that $F_{1*}v=w$.  $d$ is a regular value of $g(c,F_2)$ hence there exists $\tilde{v}$ such that $g(c,F_2)_*\tilde{v}=(g\circ F_1\times F_2)_*(v,0)$.  Therefore $(g\circ F_1\times F_2)_*(v,-\tilde{v})=0$ and $F_1*(v,-\tilde{v})=w$.  This proves $c$ is a regular value of $F_1$ on $(g\circ F_1\times F_2)^{-1}(d)$.  This proves both sides are defined and are forms on $F^{-1}(c)\times g(c,F_2)^{-1}(d)$.

  Let $x\in F^{-1}(c)$ and $y\in  g(c,F_2)^{-1}(d)$ and choose $v_i$, $w_j$ such that
\begin{equation}
\Omega^{N_1}(F_{1*}v_1,...,F_{1*}v_{n_1})=1\,, \hspace{2mm} \Omega^K(g(c,F_2)_*w_1,...,g(c,F_2)_*w_k)=1\,.
\end{equation}
Then 
\begin{equation}
\Omega^K((g\circ F_1\times F_2)_*(0,w_1),...,(g\circ F_1\times F_2)_*(0,w_k))=1
\end{equation}
and so 
\begin{align}
\delta_d( g\circ F_1\times F_2)\left(\Omega^{M_1}\wedge\Omega^{M_2}\right)&=i_{(0,w_1),...,(0,w_k)}\left(\Omega^{M_1}\wedge\Omega^{M_2}\right)\\
&=\Omega^{M_1}\wedge\left(i_{w_1,...,w_k}\Omega^{M_2}\right)\notag\\
&=\Omega^{M_1}\wedge\left(\delta_d(g(c,F_2))\Omega^{M_2}\right)\,.\notag
\end{align}
By the same argument as above, we get $\tilde{v}_i$ such that $(v_i,\tilde{v}_i)\in T_{(x,y)} (g\circ F_1\times F_2)^{-1}(d)$.  Hence
\begin{equation}
\delta_c(F_1)\left[\delta_d( g\circ F_1\times F_2)\left(\Omega^{M_1}\wedge\Omega^{M_2}\right)\right]=i_{(v_1,\tilde{v}_1),...,(v_{n_1},\tilde{v}_{n_1})}\left[\Omega^{M_1}\wedge\left(i_{w_1,...,w_k}\Omega^{M_2}\right)\right]\,.
\end{equation}
The only non-vanishing term is
\begin{equation}
\left(i_{(v_1,\tilde{v}_1),...,(v_{n_1},\tilde{v}_{n_1})}\Omega^{M_1}\right)\wedge\left(i_{w_1,...,w_k}\Omega^{M_2}\right)=\left(i_{v_1,...,v_{n_1}}\Omega^{M_1}\right)\wedge\left(i_{w_1,...,w_k}\Omega^{M_2}\right)
\end{equation}
since the other terms all contain a $m_1-n_1+l$ form on the $m_1-n_1$-dimensional manifold $F^{-1}(c)$ for some $l>0$.  This proves the result.
\end{proof}

Sometimes it is convenient to use the delta function to introduce ``dummy integration variables", by which we mean utilizing the following simple corollary of the coarea formula.
\begin{corollary}\label{dummy_int}
Let $\Omega^M$ be a volume form on $M$, $F:M\rightarrow (N,\Omega^N)$ be smooth, and $f:N\times M\rightarrow \mathbb{R}$  such that $f(F(\cdot),\cdot)\in L^1(\Omega^M)\bigcup L^+(M)$.  If $F_*$ is surjective at a.e. $x\in M$ then
\begin{equation}
\int_M f(F(x),x)\Omega^M(dx)=\int_N\int_{F^{-1}(z)} f(z,x)\delta_z(F)\Omega^M(dx) \Omega^N(dz)\,.
\end{equation}
\end{corollary}




\subsection{Applications}
\subsubsection{Relativistic Volume Element}\label{rel_vol_form}
We now discuss an application of the above results to the single particle phase space volume element. We first define it in the massive case, where the semi-Riemannian method of defining volume forms is applicable.  The massless case is often handled via a limiting argument \cite{tsamparlis}.  We will show that   our method is able to handle both the massive and massless case in a unified manner.

 Given a time oriented $n+1$ dimensional semi-Riemannian manifold $(M,g)$, there is a natural induced metric $\tilde{g}$ on the tangent bundle, called the diagonal lift.  At a given point $(x,p)\in TM$ its coordinate independent definition is
\begin{align}
\tilde{g}_{(x,p)}(v,w)=g_x(\pi_{*} v,\pi_{*} w)+g_x(D_t \gamma_v, D_t \gamma_w)\,,
\end{align}
where $\gamma_v$ is any curve in $TM$ with tangent $v$ at $x$, $\pi:TM\longrightarrow M$ is the projection, and $D_t\gamma_v$ is the covariant derivative of $\gamma_v$, treated as a vector field along the curve $\pi\circ\gamma_v$, and similarly for $\gamma_w$, see, e.g., \cite{pettini}. The result can be shown to be independent of the choice of curves.  In a coordinate system on $M$ where the the first coordinate is future timelike and the Christoffel symbols are $\Gamma^\beta_{\sigma\eta}$, consider the  induced coordinates $(x^\alpha,p^\alpha), \hspace{2mm}\alpha=0,...,n$ on $TM$.  In these coordinates we have 
\begin{equation}
\tilde{g}_{(x^\alpha,p^\alpha)}=g_{\beta,\delta}(x^\alpha)dx^\beta\otimes dx^\delta +g_{\beta,\delta}(x^{\alpha})\epsilon^\beta\otimes \epsilon^\delta, \hspace{2mm} \epsilon^\beta=dp^\beta+p^\sigma\Gamma^\beta_{\sigma\eta}(x^{\alpha})dx^\eta\,.
\end{equation}
The vertical and horizontal subspaces are spanned by
\begin{equation}\label{horizontal_subspace}
V_\alpha=\partial_{p^\alpha}, \hspace{2mm} H_\alpha=\partial_{x^\alpha}-p^\sigma\Gamma_{\sigma\alpha}^\beta\partial_{p^\beta}
\end{equation}
respectively.  The horizontal vector fields satisfy
\begin{equation}
\tilde{g}(H_\alpha,H_\beta)=g_{\alpha\beta}\,.
\end{equation}
For any manifold (oriented or not), the tangent bundle has a canonical orientation.  With this orientation, the volume form on $TM$ induced by $\tilde{g}$ is
\begin{equation}
\widetilde{dV}_{(x^\alpha,p^{\alpha})}=|g(x^\alpha)|dx^0\wedge...\wedge dx^n\wedge dp^0\wedge...\wedge dp^n\,,
\end{equation}
where $|g(x^\alpha)|$ denotes the absolute value of the determinant of the component matrix of $g$ in these coordinates.

Of primary interest in kinetic theory for a particle of mass $m\geq 0$ is the mass shell bundle
\begin{equation}
P_m=\{p\in TM :g(p,p)=m^2,\hspace{1mm}  p\text{ future directed}\}
\end{equation}
and it will be necessary to have a volume form on $P_m$.  $P_m$ is a connected component of the zero set of the of the smooth map 
\begin{equation}\label{defining_function}
h:TM\setminus \{0_x:x\in M\}\longrightarrow \mathbb{R},\hspace{2mm} h(x,p)= \frac{1}{2}(g_x(p,p)-m^2)\,.  
\end{equation} 
We remove the image of the zero section to avoid problems when $m=0$.  Its differential is
\begin{equation}\label{dh}
dh=\frac{1}{2}\frac{\partial g_{\sigma\delta}}{\partial x^\alpha}p^\sigma p^\delta dx^\alpha+g_{\sigma\delta}p^\sigma dp^\delta=g_{\sigma\delta}p^\sigma\epsilon^\delta\,.
\end{equation}
$g$ is nondegenerate, so for $p=p^{\alpha}\partial_{x^\alpha}\in TM_x\setminus{\{0_x\}}$ there is some $v=v^\alpha\partial{x^\alpha}\in TM_x$ with $g(v,p)\neq 0$.  Therefore
\begin{equation}
dh_{(x,p)}(v^\alpha\partial_{p^\alpha})=g(v,p)\neq 0\,.
\end{equation}
This proves $P_m$ is a regular level set of $h$, and hence is a closed embedded hypersurface of $TM\setminus \{0_x:x\in M\}$.  For $m\neq 0$ it is also closed in $TM$, but for $m=0$ every zero vector is a limit point of $P_m$.

\noindent{\bf Massive Case:}\\
For $m\neq 0$, we will show that $P_m$ is a semi-Riemannian hypersurface in $TM$ and hence inherits a volume form from $TM$. This is the standard method of inducing a volume form, as presented in \cite{tsamparlis}.  

The normal to $P_m$ is 
\begin{equation}
\grad h=\tilde{g}^{-1}(dh)=p^\alpha\partial_{p^\alpha}
\end{equation}
which has norm squared 
\begin{equation}
\tilde{g}(\grad h,\grad h)=g(p,p)=m^2\,.
\end{equation}
Therefore, for $m\neq 0$, $P_m$ has a unit normal $N=\grad h/m$ and so it is a semi-Riemannian hypersurface with volume form
\begin{equation}
\widetilde{dV}_m=i_N \widetilde{dV}=\frac{|g|}{m}dx^0\wedge...\wedge dx^n\wedge\left(\sum_\alpha (-1)^\alpha p^\alpha dp^0\wedge...\wedge\widehat{dp^\alpha}\wedge...\wedge dp^n\right)\,,
\end{equation}
where $i_N$ denotes the interior product (or contraction) and a hat denotes an omitted term.  We are also interested in the volume form on $P_{m,x}$ the fiber of $P_m$ over a point $x\in M$.  We obtain this by contracting $\widetilde{dV}$ with an orthonormal basis of vector fields normal to $P_{m,x}$. Such a basis is composed of $N$ together with an orthonormalization of the basis of horizontal fields, $W_\alpha=\Lambda^\beta_\alpha H_\beta$, where $H_\beta$ are defined in \req{horizontal_subspace}. Therefore we have
\begin{equation}\label{contract_horiz}
\widetilde{dV}_{m,x}=i_{W_0}...i_{W_n}\widetilde{dV}_m\,.
\end{equation}
 We can simplify these expressions by defining a coordinate system on the momentum bundle, writing $p^0$ as a function of the $p^i$.  The details, which are standard, are carried  out in Appendix  \ref{coord_comp}.  The results are
\begin{equation}
\widetilde{dV}_m=\frac{m|g|}{p_0}dx^0\wedge...\wedge dx^n\wedge dp^1\wedge...\wedge dp^n\,,
\end{equation}
\begin{equation}
\widetilde{dV}_{m,x}=\frac{m|g|^{1/2}}{p_0}dp^1\wedge...\wedge dp^n\,.
\end{equation}
We define $\pi$ and $\pi_x$ by
\begin{equation}
\pi=\frac{1}{m}\widetilde{dV}_m=\frac{|g|}{p_0}dx^0\wedge...\wedge dx^n\wedge dp^1\wedge...\wedge dp^n\,,
\end{equation}
\begin{equation}\label{pi_x}
\pi_x=\frac{1}{m}\widetilde{dV}_{m,x}=\frac{|g|^{1/2}}{p_0}dp^1\wedge...\wedge dp^n\,.
\end{equation}
We will typically omit the subscript $x$ and let the context distinguish whether we are integrating over the full momentum bundle (i.e. both over spacetime and momentum variables) or just momentum space at a single point in spacetime.  \\

\noindent{\bf Massless Case:}\\
When $m=0$ the above construction fails.  However, we can use Theorem \ref{induced_vol_form} to induce a volume form using the map \req{defining_function} defined above. Here we carry out the construction for the induced volume form on $P_{m,x}$ for any $m\geq 0$. The volume form on each tangent space $T_xM$ is
\begin{equation}
\tilde{dV}_x=|g(x)|^{1/2}dp^0\wedge...\wedge dp^n\,.
\end{equation}
We assume that the coordinates are chosen so that the vector field $\partial_{p^0}$ is timelike. By \req{dh} we find
\begin{equation}
dh(\partial_{p^0})=g_{\alpha 0}p^\alpha\neq 0
\end{equation}
on $P_{m,x}$.  Therefore, by Corollary \ref{induced_vol_eq} the induced volume form is
\begin{align}\label{mass_shell_vol}
\omega=&\frac{1}{dh(\partial_{p^0})} i_{\partial_{p^0}} \tilde{dV}_x
=\frac{|g|^{1/2}}{p_0}dp^1\wedge...\wedge dp^n\,.
\end{align}
We can also pull this back under the coordinate chart on $P_{m,x}$ defined in Appendix \ref{coord_comp} and obtain the same expression in coordinates. This result agrees with our prior definition of \req{pi_x} in the case where $m>0$ but is also able to handle the massless case in a uniform manner, without resorting to a limiting argument as $m\rightarrow 0$.

We also point out another convention in common use where $h$ is replaced by $2h$.  This leads to an additional factor of $1/2$ in the volume element, distinguishing this definition from the one based on semi-Riemannian geometry.  However, the convention
\begin{equation}
\omega=\frac{|g|^{1/2}}{2p_0}dp^1\wedge...\wedge dp^n
\end{equation}
 is in common use and will be employed in the scattering integral computations in Appendix \ref{ch:coll_simp}.

\subsubsection{Relativistic Phase Space}
Here we justify several manipulations that are useful for working with relativistic phase space integrals.

\begin{lemma}\label{parallel_lemma}
Let $V$ be an $n$-dimensional vector space.  The subset of $\prod_1^N V\setminus\{0\}$ consisting of $N$-tuples of parallel vectors is an $n+N-1$ dimensional closed submanifold of $\prod_1^N V\setminus\{0\}$.
\end{lemma}
\begin{proof}
The map $V\times \mathbb{R}^{N-1}\rightarrow  \prod_1^N V\setminus\{0\}$ given by
\begin{equation}
F(p,a^2,...,a^N)=(p,a^2p,...,a^{N}p)
\end{equation}
is an injective immersion and maps onto the desired set.
\end{proof}
For reactions converting $k$ particles to $l$ particles, the relevant phase space is $3(k+l)-4$ dimensional and so for $k+l\geq 4$ (in particular for $2$-$2$ reactions), the set of parallel $4$-momenta is lower dimensional and can be ignored. This will be useful as we proceed.

\begin{lemma}
Let $N\geq 4$. Then
\begin{equation}
\prod_i \delta(p_i^2-m_i^2)d^4p_i=\left(\prod_i \delta(p_i^2-m_i^2)\right)\prod_i d^4p_i
\end{equation}
 and 
\begin{equation}
\delta(\Delta p)\left[\left(\prod_i \delta(p_i^2-m_i^2)\right)\prod_i d^4p_i\right]=\left(\delta(\Delta p)\prod_i \delta(p_i^2-m_i^2)\right)\prod_i d^4p_i\,,
\end{equation}
where each $d^4p_i$ is the standard volume form on future directed vectors, $\{p:p^2\geq 0, p^0>0\}$, we give $\mathbb{R}$ its standard volume form, and $\Delta p=a^ip_i$, $a^i=1$, $i=1,...,l$, $a^i=-1$, $i=l,...,N$. 
\end{lemma}
\begin{proof}
Let $F_1(p_i)=(p_1^2,...,p_N^2)$ and $F_2(p_i)=(\Delta p,F_1(p_i))$.  We need to show that $(m_1^2,...,m_N^2)$ is a regular value of $F_1$ and $(0,m_1^2,...,m_k^2)$ is a regular value of $F_2$.  The result then follows from Theorem \ref{delta_associative}.

It holds for $F_1$ since each $p_i\neq 0$. For $F_2$, the differential is
\begin{equation}
(F_2)*=\left( \begin{array}{cccc}
a^{1}I&a^{2}I&...& a^{N}I \\
2 \eta_{ij}p^j_1&0&...&0\\
\vdots&&&\vdots\\
0&...&0&2 \eta_{ij}p^j_N\\
\end{array} \right)
\end{equation}
where $I$ is the $4$-by-$4$ identity.  The fact that $(F_1)_*$ is onto means that we need only show $(F_2)_*$ maps onto $\mathbb{R}^4\times(0,...,0)$.  

By Lemma \ref{parallel_lemma} we assume there exists $i,j$ such that $p_i,p_j$ are not parallel. We are done if for each standard basis vector $e_k\in\mathbb{R}^4$ there exists $q\in\mathbb{R}^4$ such that
\begin{equation}
p_i\cdot q=\frac{1}{a^j}p_i\cdot e_k,\hspace{2mm} p_j\cdot q=0\,.
\end{equation}
If $p_j$ is null then there is a $c$ such that $q=c p_j$ satisfies these conditions. If $p_j$ is non-null then complete it to an orthonormal basis.  $p_i$ must have a component along the orthogonal complement of $p_j$ and we can take $q$ to be proportional to that component.

\end{proof}



\subsection{Volume Form in Coordinates}\label{coord_comp}
Here we derive a useful formula for the volume form on the momentum bundle in a simple coordinate system.  We begin in a coordinate system $x^\alpha$ on $U\subset M$ and the induced coordinates $p^\alpha$ on $TM$ where our only assumption is that the $0$'th coordinate direction is future timelike, and so $g_{00}>0$.  For any $v^i\in \mathbb{R}^n$, let $v^0=-g_{0i}v^i/g_{00}$.  $v^\alpha$ is orthogonal to the $0$'th coordinate direction, and therefore spacelike. Hence 
\begin{equation}
0\geq g_{\alpha \beta}v^\alpha v^\beta=-(g_{0i}v^i)^2/g_{00}+g_{ij}v^iv^j\,.
\end{equation}
and is zero iff $v^\alpha=0$. Therefore, the following map is well defined
\begin{align}
(x^\alpha,p^j)&\longrightarrow (x^\alpha,p^0(x^\alpha,p^j),p^1,...,p^n),  \hspace{2mm} \alpha=0...n, \hspace{1mm} j=1...n \,,\notag\\
 p^0&=-g_{0j}p^j/g_{00}+\left((g_{0j}p^j/g_{00})^2+(m^2-g_{ij}p^ip^j)/g_{00}\right)^{1/2}\,,
\end{align}
and is smooth on $\mathbb{R}^{n+1}\times\mathbb{R}^n$ if $m\neq 0$, and on $\mathbb{R}^{n+1}\times\left(\mathbb{R}^n\setminus{0}\right)$ if $m=0$.  We also have $g_{00}p^0+g_{0j}p^j>0$ under either of these cases, and so the resulting element of $TM$ is future directed and has squared norm $m^2$, so it maps into $P_m$.  It is a bijection and has full rank, hence it is a coordinate system on $P_m$.  In these coordinates, the volume form is
\begin{align}
\widetilde{dV}_m=&\frac{|g|}{m}dx^0\wedge...\wedge dx^n\wedge\left(p^0dp^1\wedge...\wedge dp^n+\sum_j (-1)^j p^j dp^0\wedge...\wedge\widehat{dp^j}\wedge...\wedge dp^n\right)\notag\\
dp^0=&\partial_{x^\alpha} p^0dx^\alpha+\partial_{p^j}(p^0) dp^j\,.
\end{align}
The terms in $dp^0$ involving $dx^\alpha$ drop out once they are wedged with $dx^0\wedge...\wedge dx^n$, hence
\begin{align}
&\widetilde{dV}_m\\
=&\frac{|g|}{m}dx^0\wedge...\wedge dx^n\wedge\left(p^0dp^1\wedge...\wedge dp^n+\sum_{i,j} (-1)^j p^j \partial_{p^i}p^0 dp^i\wedge...\wedge\widehat{dp^j}\wedge...\wedge dp^n\right)\notag\\
=&\frac{|g|}{m}\left(p^0-\sum_{j}p^j \partial_{p^j}(p^0) \right)dx^0\wedge...\wedge dx^n\wedge dp^1\wedge...\wedge dp^n\,,\notag\\
&p^0-\sum_jp^j\partial_{p^j}(p^0)= p^0+g_{0j}p^j/g_{00}-\frac{(g_{0j}p^j/g_{00})^2-g_{ij}p^ip^j/g_{00}}{\left((g_{0j}p^j/g_{00})^2+(m^2-g_{ij}p^ip^j)/g_{00}\right)^{1/2}}\notag\\
=&\frac{1}{p_0}\left(\frac{1}{g_{00}}(g_{00}p^0+g_{0,j}p^j)^2-(g_{0j}p^j)^2/g_{00}+g_{ij}p^ip^j\right)=\frac{m^2}{p_0}\,.\notag
\end{align}
Therefore
\begin{equation}
\widetilde{dV}_m=\frac{m|g|}{p_0}dx^0\wedge...\wedge dx^n\wedge dp^1\wedge...\wedge dp^n\,.
\end{equation}

To compute the volume form on $P_{m,x}$, recall  that 
\begin{equation}\label{contract_horiz}
\widetilde{dV}_{m,x}=i_{W_0}...i_{W_n}\widetilde{dV}_m\,.
\end{equation}
Where $W_i$ is an orthonormalization of the basis of horizontal fields, $W_\alpha=\Lambda^\beta_\alpha H_\beta$, where $H_\beta$ are defined in \req{horizontal_subspace}. All of the contractions in \req{contract_horiz} that involve the $dp^\alpha$'s will be zero when restricted to $P_{m,x}$ since the $dx^\alpha$ are zero there. Hence we obtain
\begin{align}\label{dV_x}
\widetilde{dV}_{m,x}=&\frac{|g|}{m}\left(p^0-\sum_{j}p^j \partial_{p^j}(p^0) \right)dx^0\wedge...\wedge dx^n\left(W_0,...,W_n)\right) dp^1\wedge...\wedge dp^n\\
=&\frac{|g|\det(\Lambda)}{m}\left(p^0-\sum_{j}p^j \partial_{p^j}(p^0) \right)dx^0\wedge...\wedge dx^n\left(H_0,...,H_n)\right) dp^1\wedge...\wedge dp^n\notag\\
=&\frac{|g|^{1/2}}{m}\left(p^0-\sum_{j}p^j \partial_{p^j}(p^0) \right) dp^1\wedge...\wedge dp^n\,,\notag
\end{align}
where we used $\det(\Lambda^\sigma_\alpha g_{\sigma\delta}\Lambda^\delta_\beta)=1$.
 In the coordinate system on $P_{m,x}$
\begin{align}
(p^j)&\longrightarrow (p^0(x^\alpha,p^j),p^1,...,p^n)\,,\\
 p^0&=-g_{0j}(x)p^j/g_{00}(x)+\left((g_{0j}(x)p^j/g_{00}(x))^2+(m^2-g_{ij}(x)p^ip^j)/g_{00}(x)\right)^{1/2}\,.\notag
\end{align}
 the same calculation as above gives the formula
\begin{equation}
\widetilde{dV}_{m,x}=\frac{m|g|^{1/2}}{p_0}dp^1\wedge...\wedge dp^n\,.
\end{equation}



